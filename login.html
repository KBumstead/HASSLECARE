<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">

  <title>create account</title>
  <link rel="stylesheet" href="/styles/login.css">

</head>

<body>

  <header>
    <div class="logo-box">
      <h2><a class="logo" id="logo-header">HassleCare</a></h2>
    </div>
    <div class="searchBar">
      <input type="search_bar" placeholder="find services">
    </div>

    <nav class="navbar">
      <button class="login-header" id="login-header">
        Login
      </button>
      <button class="register-header" id="register-header">
        Register
      </button>
      <button class="login-header" id="welcome-header" style="display: none">
        Hi!
      </button>
      <button class="register-header" id="account-header" style="display: none">
        Account
      </button>
    </nav>
  </header>

  <div class="wrapper">
    <div class="login-box form">
      <h2>Login</h2>
      <form id="login-form">
        <div class="input-box">
          <p>Email</p>
          <div class="input-bar">
            <input type="email" id="email" required>
          </div>
        </div>
        <div class="input-box">
          <p>Password</p>
          <div class="input-bar">
            <input type="password" id="password" required>
          </div>
        </div>

        <button type="button" id="login-btn" class="login-btn">
          Login
        </button>

        <div class="login-register">
          <p>Don't have an account? <a class="register-link" href="/register.html">Register</a></p>
        </div>

        <!-- Add a div for displaying the error message -->
        <div id="error-message" class="error-message"></div>
      </form>
    </div>
  </div>

  <footer>
    <p>Copyright HassleCare 2023</p>
  </footer>

  <script src="/scripts/buttonFunction.js"></script>
  <script src="/scripts/common.js"></script>
  <script>
    document.getElementById("login-btn").addEventListener("click", function () {
      event.preventDefault();

      // Get the input values
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      // Create the payload
      const payload = {
        email: email,
        password: password,
      };

      // Send a fetch request to your login URL
      fetch("https://alert-tourmaline-pantydraco.glitch.me/accounts/login", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(payload),
      })
        .then((response) => {
          if (response.ok) {
            return response.json();
          } else {
            // Login failed, handle the error here
            document.getElementById("error-message").textContent = "Login failed. Please check your credentials.";
            throw new Error("Login failed");
          }
        })
        .then((body) => {
          const sessionToken = body.sessionToken;
          const accountId = body.accountId;
          setCookie("sessionToken", sessionToken);
          setCookie("accountId", accountId);
          window.location.href = "/account";
        })
        .catch((error) => {
          // Handle any errors
          console.error("Error:", error);
        });
    });

  </script>
</body>

</html>